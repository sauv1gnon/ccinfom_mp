<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/13" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.ccinfoms17grp2.ui.BookAppointmentController">
    <left>
        <VBox styleClass="dashboard-left-panel" prefWidth="250.0">
            <padding>
                <Insets top="20.0" right="20.0" bottom="20.0" left="20.0"/>
            </padding>
            <spacing>20.0</spacing>
            
            <VBox spacing="12.0">
                <Button fx:id="cancelButton" styleClass="button" text="Cancel Booking" maxWidth="Infinity" onAction="#handleCancelBooking" />
                <Button styleClass="button flat" text="Homepage" maxWidth="Infinity" onAction="#handleBackToHomepage" />
            </VBox>

            <Separator />
            <Label text="Booking Progress" styleClass="label app-title">
                <font><Font size="14.0" /></font>
            </Label>
            <VBox spacing="8.0">
                <HBox spacing="8.0" alignment="CENTER_LEFT">
                    <Label fx:id="step1Icon" text="○" styleClass="step-indicator" />
                    <Label text="Date & Time" styleClass="step-label" />
                </HBox>
                <HBox spacing="8.0" alignment="CENTER_LEFT">
                    <Label fx:id="step2Icon" text="○" styleClass="step-indicator" />
                    <Label text="Location" styleClass="step-label" />
                </HBox>
                <HBox spacing="8.0" alignment="CENTER_LEFT">
                    <Label fx:id="step3Icon" text="○" styleClass="step-indicator" />
                    <Label text="Specializations" styleClass="step-label" />
                </HBox>
                <HBox spacing="8.0" alignment="CENTER_LEFT">
                    <Label fx:id="step4Icon" text="○" styleClass="step-indicator" />
                    <Label text="Select Branch" styleClass="step-label" />
                </HBox>
                <HBox spacing="8.0" alignment="CENTER_LEFT">
                    <Label fx:id="step5Icon" text="○" styleClass="step-indicator" />
                    <Label text="Select Doctor" styleClass="step-label" />
                </HBox>
            </VBox>
        </VBox>
    </left>

    <center>
        <VBox spacing="20.0" styleClass="dashboard-right-panel">
            <padding>
                <Insets top="20.0" right="20.0" bottom="20.0" left="20.0"/>
            </padding>
            
            <Label styleClass="label app-title" text="Book an Appointment">
                <font><Font name="Segoe UI" size="24.0" /></font>
            </Label>

            <StackPane fx:id="progressOverlay" visible="false" managed="false" 
                       style="-fx-background-color: rgba(0,0,0,0.5);" 
                       VBox.vgrow="ALWAYS">
                <VBox alignment="CENTER" spacing="15.0" 
                      style="-fx-background-color: white; -fx-padding: 30; -fx-background-radius: 10;">
                    <ProgressIndicator />
                    <Label fx:id="progressLabel" text="Processing..." />
                </VBox>
            </StackPane>

            <StackPane fx:id="stepContainer" VBox.vgrow="ALWAYS">
                
                <VBox fx:id="step1Panel" spacing="15.0" styleClass="login-container" maxWidth="600.0">
                    <padding>
                        <Insets top="30.0" right="30.0" bottom="30.0" left="30.0"/>
                    </padding>
                    
                    <Label styleClass="login-subtitle" text="Step 1: Select Appointment Date and Time" />
                    
                    <VBox spacing="8.0">
                        <Label text="Appointment Date:" />
                        <DatePicker fx:id="datePicker" promptText="Select date" maxWidth="Infinity" />
                    </VBox>
                    
                    <VBox spacing="8.0">
                        <Label text="Appointment Time:" />
                        <HBox spacing="10.0">
                            <ComboBox fx:id="hourComboBox" promptText="Hour" prefWidth="100.0" />
                            <Label text=":" alignment="CENTER" style="-fx-font-size: 18px;" />
                            <ComboBox fx:id="minuteComboBox" promptText="Minute" prefWidth="100.0" />
                        </HBox>
                        <Label text="Available hours: 8:00 AM - 8:00 PM (30-minute intervals)" 
                               style="-fx-font-size: 10px; -fx-text-fill: gray;" />
                    </VBox>
                    
                    <HBox spacing="15.0">
                        <Button styleClass="button" text="Next" onAction="#handleNextStep" prefWidth="120.0" />
                    </HBox>
                </VBox>

                <VBox fx:id="step2Panel" spacing="15.0" styleClass="login-container" maxWidth="600.0" visible="false">
                    <padding>
                        <Insets top="30.0" right="30.0" bottom="30.0" left="30.0"/>
                    </padding>
                    
                    <Label styleClass="login-subtitle" text="Step 2: Enter Your Location" />
                    
                    <VBox spacing="8.0">
                        <Label text="Your Address or Location:" />
                        <TextField fx:id="locationField" promptText="e.g., 123 Main St, Cityville or landmark name" />
                        <Label fx:id="geocodeResultLabel" text="" 
                               style="-fx-font-size: 10px; -fx-text-fill: green;" wrapText="true" />
                    </VBox>
                    
                    <HBox spacing="15.0">
                        <Button styleClass="button flat" text="Back" onAction="#handlePreviousStep" prefWidth="120.0" />
                        <Button fx:id="geocodeButton" styleClass="button" text="Verify Location" 
                                onAction="#handleGeocodeLocation" prefWidth="150.0" />
                        <Button fx:id="nextStep2Button" styleClass="button" text="Next" 
                                onAction="#handleNextStep" prefWidth="120.0" disable="true" />
                    </HBox>
                </VBox>

                <VBox fx:id="step3Panel" spacing="15.0" styleClass="login-container" maxWidth="600.0" visible="false">
                    <padding>
                        <Insets top="30.0" right="30.0" bottom="30.0" left="30.0"/>
                    </padding>
                    
                    <Label styleClass="login-subtitle" text="Step 3: Select Specializations" />
                    <Label text="Select one or more specializations you need:" 
                           style="-fx-font-size: 12px; -fx-text-fill: gray;" />
                    
                    <ListView fx:id="specializationListView" prefHeight="200.0">
                        <placeholder>
                            <Label text="Loading specializations..." />
                        </placeholder>
                    </ListView>
                    
                    <HBox spacing="15.0">
                        <Button styleClass="button flat" text="Back" onAction="#handlePreviousStep" prefWidth="120.0" />
                        <Button styleClass="button" text="Next" onAction="#handleNextStep" prefWidth="120.0" />
                    </HBox>
                </VBox>

                <VBox fx:id="step4Panel" spacing="15.0" styleClass="login-container" maxWidth="700.0" visible="false">
                    <padding>
                        <Insets top="30.0" right="30.0" bottom="30.0" left="30.0"/>
                    </padding>
                    
                    <Label styleClass="login-subtitle" text="Step 4: Select Branch" />
                    <Label fx:id="recommendationLabel" text="Finding branches near you..." 
                           style="-fx-font-size: 12px; -fx-text-fill: gray;" />
                    
                    <TableView fx:id="branchTableView" prefHeight="250.0" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="branchNameColumn" text="Branch Name" prefWidth="200.0" />
                            <TableColumn fx:id="branchAddressColumn" text="Address" prefWidth="250.0" />
                            <TableColumn fx:id="branchDistanceColumn" text="Distance (km)" prefWidth="100.0" />
                            <TableColumn fx:id="branchDoctorCountColumn" text="Doctors Available" prefWidth="120.0" />
                        </columns>
                        <placeholder>
                            <Label text="No branches found with matching doctors" />
                        </placeholder>
                    </TableView>
                    
                    <HBox spacing="15.0">
                        <Button styleClass="button flat" text="Back" onAction="#handlePreviousStep" prefWidth="120.0" />
                        <Button fx:id="nextStep4Button" styleClass="button" text="Next" 
                                onAction="#handleNextStep" prefWidth="120.0" disable="true" />
                    </HBox>
                </VBox>

                <VBox fx:id="step5Panel" spacing="15.0" styleClass="login-container" maxWidth="700.0" visible="false">
                    <padding>
                        <Insets top="30.0" right="30.0" bottom="30.0" left="30.0"/>
                    </padding>
                    
                    <Label styleClass="login-subtitle" text="Step 5: Select Doctor" />
                    <Label fx:id="branchInfoLabel" text="Available doctors at selected branch" 
                           style="-fx-font-size: 12px; -fx-text-fill: gray;" />
                    
                    <ListView fx:id="doctorListView" prefHeight="250.0" VBox.vgrow="ALWAYS">
                        <placeholder>
                            <Label text="No available doctors" />
                        </placeholder>
                    </ListView>
                    
                    <VBox spacing="8.0">
                        <Label text="Appointment Summary:" style="-fx-font-weight: bold;" />
                        <Label fx:id="summaryLabel" text="" wrapText="true" />
                    </VBox>
                    
                    <HBox spacing="15.0">
                        <Button styleClass="button flat" text="Back" onAction="#handlePreviousStep" prefWidth="120.0" />
                        <Button fx:id="bookButton" styleClass="button" text="Confirm & Book" 
                                onAction="#handleBookAppointment" prefWidth="150.0" disable="true" />
                    </HBox>
                </VBox>

            </StackPane>
        </VBox>
    </center>
</BorderPane>